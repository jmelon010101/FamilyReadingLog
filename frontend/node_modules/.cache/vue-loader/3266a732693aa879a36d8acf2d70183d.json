{"remainingRequest":"/Users/musicmaster/Desktop/capstone4/capstone-family_reading/frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/musicmaster/Desktop/capstone4/capstone-family_reading/frontend/src/views/Accounts.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/musicmaster/Desktop/capstone4/capstone-family_reading/frontend/src/views/Accounts.vue","mtime":1586821964037},{"path":"/Users/musicmaster/Desktop/capstone4/capstone-family_reading/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/musicmaster/Desktop/capstone4/capstone-family_reading/frontend/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/musicmaster/Desktop/capstone4/capstone-family_reading/frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/musicmaster/Desktop/capstone4/capstone-family_reading/frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgppbXBvcnQgYXV0aCBmcm9tICdAL2F1dGgnOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdhY2NvdW50cycsCiAgIHByb3BzOiB7CiAgICAgIGN1cnJlbnRVc2VyOiBPYmplY3QKICAgIH0sCiAgIGRhdGEoKSB7CiAgICAgcmV0dXJuIHsKICAgICAgICB1c2VyczogW10sCiAgICAgICAgZGVsZXRlVXNlcklkOiBudWxsLAogICAgICAgIGZhbWlseTogJycKICAgICAgfQogICAgfSwKICBtZXRob2RzOiB7CiAgICBnZXRBbGxVc2VycygpIHsKICAgICAgZmV0Y2goYCR7cHJvY2Vzcy5lbnYuVlVFX0FQUF9SRU1PVEVfQVBJfS9hcGkvdXNlcnMvJHt0aGlzLmN1cnJlbnRVc2VyLmZhbWlseUlkfWAsIHsKICAgICAgICBtZXRob2Q6ICdHRVQnLAogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICBBdXRob3JpemF0aW9uOiAnQmVhcmVyICcgKyBhdXRoLmdldFRva2VuKCkKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKQogICAgICAgIH0pCiAgICAgICAgLnRoZW4oKGRhdGEpID0+IHsKICAgICAgICAgIHRoaXMudXNlcnMgPSBkYXRhOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKChlcnIpPT4gY29uc29sZS5lcnJvcihlcnIpKTsgCiAgICB9LAogICBkZWxldGVVc2VyKCkgewogICAgICBmZXRjaChgJHtwcm9jZXNzLmVudi5WVUVfQVBQX1JFTU9URV9BUEl9L2FwaS91c2VyLyR7dGhpcy5kZWxldGVVc2VySWR9YCwgewogICAgICAgIG1ldGhvZDogJ0RFTEVURScsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgYXV0aC5nZXRUb2tlbigpLAogICAgICAgIH0sCiAgICAgICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsCiAgICAgIH0pCiAgICAgICAgLnRoZW4oKHJlc3BvbnNlKSA9PiB7CiAgICAgICAgICBpZiAocmVzcG9uc2Uub2spIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLnVzZXJzLm1hcCgodXNlcikgPT4gdXNlci5pZCkuaW5kZXhPZih0aGlzLmRlbGV0ZVVzZXJJZCk7CiAgICAgICAgICAgIHRoaXMudXNlcnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMuZGVsZXRlVXNlcklkID0gbnVsbDsKICAgICAgICAgIHRoaXMuZ2V0QWxsVXNlcnMoKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpOwogICAgICAgIGlmICh0aGlzLnVzZXJzLmxlbmd0aCA9PT0gMSkgewogICAgICAgICAgYXV0aC5sb2dvdXQoKTsKICAgICAgICAgIHRoaXMuJGVtaXQoJ3VwZGF0ZS11c2VyJykKICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCcvbG9naW4nKTsKICAgICAgICB9CiAgICAgIH0sCiAgICAgZ2V0ZmFtaWx5KCkgewogICAgICBmZXRjaChgJHtwcm9jZXNzLmVudi5WVUVfQVBQX1JFTU9URV9BUEl9L2FwaS9mYW1pbGllcy8ke3RoaXMuY3VycmVudFVzZXIuZmFtaWx5SWR9YCwgewogICAgICAgIG1ldGhvZDogJ0dFVCcsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgQXV0aG9yaXphdGlvbjogJ0JlYXJlciAnICsgYXV0aC5nZXRUb2tlbigpLAogICAgICAgIH0sCiAgICAgICAgY3JlZGVudGlhbHM6ICdzYW1lLW9yaWdpbicsCiAgICAgICAgfSkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCkKICAgICAgICB9KQogICAgICAgIC50aGVuKChkYXRhKSA9PiB7CiAgICAgICAgICB0aGlzLmZhbWlseSA9IGRhdGE7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKGVycik9PiBjb25zb2xlLmVycm9yKGVycikpOyAKICAgICAgfQogICAgfSwKICAgIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmdldEFsbFVzZXJzKCk7CiAgICB0aGlzLmdldGZhbWlseSgpOwogIH0KfQo="},{"version":3,"sources":["Accounts.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6DA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Accounts.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div id=\"accounts\">\n    <h3 class = \"text-center\">Family Members - {{this.family.familyname}}  </h3>\n    <table class = \"users table table-striped\">\n      <thead class=\"thead-dark\">\n      <tr>\n        <th scope=\"col\">#</th>\n        <th scope=\"col\">Username </th>\n        <th scope=\"col\">parent/child</th>\n        <th scope=\"col\"></th>\n      </tr>\n      </thead>\n      <tbody>\n        <tr class=\"users\" v-for=\"user in users\" v-bind:key=\"user.id\">\n          <td scope=\"row\">{{user.id}}</td>\n          <td>{{user.username}}</td>\n          <td>{{user.role}}</td>\n          <td>\n            <b-button v-if=\"users.length === 1\" variant=\"outline-danger\" size=\"sm\" @click=\"deleteUserId = user.id\"\n            v-b-modal.confirmDeleteFamily>Delete Family Account</b-button>\n            <b-button v-else variant=\"outline-danger\" size=\"sm\" @click=\"deleteUserId = user.id\"\n            v-b-modal.confirmDelete> Delete</b-button>\n          </td>\n        </tr>\n      </tbody>\n    </table>\n  <router-link\n      :to=\"{ name: 'register', params: { role:'parent'} }\"\n      tag=\"button\"\n      class=\"btn btn-outline-primary btn-sm\"\n       >Add Parent</router-link>\n   <router-link\n      :to=\"{ name: 'register', params: { role:'child'} }\"\n        tag=\"button\"\n        class=\"btn btn-outline-primary btn-sm\"\n        >Add Child</router-link>\n    <p class=\"text-right\"> {{currentUser.familyId}}</p>\n      <!-- Modal Component -->\n  <b-modal\n    id=\"confirmDelete\"\n    title=\"Delete User\"\n    ok-title=\"Delete User\"\n    @ok=\"deleteUser\"\n  >\n    <p class=\"my-4\">Are you sure you want to delete this User? (Warning: deleting this user will \n      delete all reading activity for this user.) </p>\n  </b-modal>\n  <b-modal\n    id=\"confirmDeleteFamily\"\n    title=\"Delete Family Account\"\n    ok-title=\"Delete Family Account\"\n    @ok=\"deleteUser\"\n  >\n    <p class=\"my-4\">Are you sure you want to delete this Family Account? (Warning: deleting this family account will \n      delete all records associated with this family account.) </p>\n  </b-modal>\n  </div>\n</template>\n\n<script>\n\nimport auth from '@/auth';\n\nexport default {\n  name: 'accounts',\n   props: {\n      currentUser: Object\n    },\n   data() {\n     return {\n        users: [],\n        deleteUserId: null,\n        family: ''\n      }\n    },\n  methods: {\n    getAllUsers() {\n      fetch(`${process.env.VUE_APP_REMOTE_API}/api/users/${this.currentUser.familyId}`, {\n        method: 'GET',\n          headers: {\n          Accept: 'application/json',\n          Authorization: 'Bearer ' + auth.getToken()\n          }\n        })\n        .then((response) => {\n          return response.json()\n        })\n        .then((data) => {\n          this.users = data;\n        })\n        .catch((err)=> console.error(err)); \n    },\n   deleteUser() {\n      fetch(`${process.env.VUE_APP_REMOTE_API}/api/user/${this.deleteUserId}`, {\n        method: 'DELETE',\n        headers: {\n          Authorization: 'Bearer ' + auth.getToken(),\n        },\n        credentials: 'same-origin',\n      })\n        .then((response) => {\n          if (response.ok) {\n            const index = this.users.map((user) => user.id).indexOf(this.deleteUserId);\n            this.users.splice(index, 1);\n          }\n          this.deleteUserId = null;\n          this.getAllUsers();\n        })\n        .catch((err) => console.error(err));\n        if (this.users.length === 1) {\n          auth.logout();\n          this.$emit('update-user')\n          this.$router.push('/login');\n        }\n      },\n     getfamily() {\n      fetch(`${process.env.VUE_APP_REMOTE_API}/api/families/${this.currentUser.familyId}`, {\n        method: 'GET',\n        headers: {\n          Authorization: 'Bearer ' + auth.getToken(),\n        },\n        credentials: 'same-origin',\n        })\n        .then((response) => {\n          return response.json()\n        })\n        .then((data) => {\n          this.family = data;\n        })\n        .catch((err)=> console.error(err)); \n      }\n    },\n    created() {\n    this.getAllUsers();\n    this.getfamily();\n  }\n}\n</script>\n\n<style scoped>\n  .bold {\n    font-weight: bold;\n  }\n  button {\n    margin-right: 5px;\n  }\n  span.badge {\n    margin-right:5px;\n  }\n  .actions .btn{\n    margin-top: 0px;\n  }\n\n</style>"]}]}